{"version":3,"file":"connectors/webauthn-fallback.af943a96dff6c6ea7a19.js","mappings":"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","sources":["webpack://@bitwarden/web-vault/./src/connectors/common-webauthn.ts","webpack://@bitwarden/web-vault/./src/connectors/common.ts","webpack://@bitwarden/web-vault/./src/connectors/webauthn-fallback.ts","webpack://@bitwarden/web-vault/webpack/bootstrap","webpack://@bitwarden/web-vault/webpack/runtime/make namespace object","webpack://@bitwarden/web-vault/webpack/startup"],"sourcesContent":["export function buildDataString(assertedCredential: PublicKeyCredential) {\n  const response = assertedCredential.response as AuthenticatorAssertionResponse;\n\n  const authData = new Uint8Array(response.authenticatorData);\n  const clientDataJSON = new Uint8Array(response.clientDataJSON);\n  const rawId = new Uint8Array(assertedCredential.rawId);\n  const sig = new Uint8Array(response.signature);\n\n  const data = {\n    id: assertedCredential.id,\n    rawId: coerceToBase64Url(rawId),\n    type: assertedCredential.type,\n    extensions: assertedCredential.getClientExtensionResults(),\n    response: {\n      authenticatorData: coerceToBase64Url(authData),\n      clientDataJson: coerceToBase64Url(clientDataJSON),\n      signature: coerceToBase64Url(sig),\n    },\n  };\n\n  return JSON.stringify(data);\n}\n\nexport function parseWebauthnJson(jsonString: string) {\n  const json = JSON.parse(jsonString);\n\n  const challenge = json.challenge.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  json.challenge = Uint8Array.from(atob(challenge), (c) => c.charCodeAt(0));\n\n  json.allowCredentials.forEach((listItem: any) => {\n    // eslint-disable-next-line\n    const fixedId = listItem.id.replace(/\\_/g, \"/\").replace(/\\-/g, \"+\");\n    listItem.id = Uint8Array.from(atob(fixedId), (c) => c.charCodeAt(0));\n  });\n\n  return json;\n}\n\n// From https://github.com/abergs/fido2-net-lib/blob/b487a1d47373ea18cd752b4988f7262035b7b54e/Demo/wwwroot/js/helpers.js#L34\n// License: https://github.com/abergs/fido2-net-lib/blob/master/LICENSE.txt\nfunction coerceToBase64Url(thing: any) {\n  // Array or ArrayBuffer to Uint8Array\n  if (Array.isArray(thing)) {\n    thing = Uint8Array.from(thing);\n  }\n\n  if (thing instanceof ArrayBuffer) {\n    thing = new Uint8Array(thing);\n  }\n\n  // Uint8Array to base64\n  if (thing instanceof Uint8Array) {\n    let str = \"\";\n    const len = thing.byteLength;\n\n    for (let i = 0; i < len; i++) {\n      str += String.fromCharCode(thing[i]);\n    }\n    thing = window.btoa(str);\n  }\n\n  if (typeof thing !== \"string\") {\n    throw new Error(\"could not coerce to string\");\n  }\n\n  // base64 to base64url\n  // NOTE: \"=\" at the end of challenge is optional, strip it off here\n  thing = thing.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=*$/g, \"\");\n\n  return thing;\n}\n","export function getQsParam(name: string) {\n  const url = window.location.href;\n  // eslint-disable-next-line\n  name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n  const regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\");\n  const results = regex.exec(url);\n\n  if (!results) {\n    return null;\n  }\n  if (!results[2]) {\n    return \"\";\n  }\n\n  return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n}\n\nexport function b64Decode(str: string, spaceAsPlus = false) {\n  if (spaceAsPlus) {\n    str = str.replace(/ /g, \"+\");\n  }\n\n  return decodeURIComponent(\n    Array.prototype.map\n      .call(atob(str), (c: string) => {\n        return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\n      })\n      .join(\"\")\n  );\n}\n","import { b64Decode, getQsParam } from \"./common\";\nimport { buildDataString, parseWebauthnJson } from \"./common-webauthn\";\n\nrequire(\"./webauthn.scss\");\n\nlet parsed = false;\nlet webauthnJson: any;\nlet parentUrl: string = null;\nlet sentSuccess = false;\nlet locale = \"en\";\n\nlet locales: any = {};\n\nfunction parseParameters() {\n  if (parsed) {\n    return;\n  }\n\n  parentUrl = getQsParam(\"parent\");\n  if (!parentUrl) {\n    error(\"No parent.\");\n    return;\n  } else {\n    parentUrl = decodeURIComponent(parentUrl);\n  }\n\n  locale = getQsParam(\"locale\").replace(\"-\", \"_\");\n\n  const version = getQsParam(\"v\");\n\n  if (version === \"1\") {\n    parseParametersV1();\n  } else {\n    parseParametersV2();\n  }\n  parsed = true;\n}\n\nfunction parseParametersV1() {\n  const data = getQsParam(\"data\");\n  if (!data) {\n    error(\"No data.\");\n    return;\n  }\n\n  webauthnJson = b64Decode(data);\n}\n\nfunction parseParametersV2() {\n  let dataObj: { data: any; btnText: string } = null;\n  try {\n    dataObj = JSON.parse(b64Decode(getQsParam(\"data\")));\n  } catch (e) {\n    error(\"Cannot parse data.\");\n    return;\n  }\n\n  webauthnJson = dataObj.data;\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", async () => {\n  parseParameters();\n  try {\n    locales = await loadLocales(locale);\n  } catch {\n    // eslint-disable-next-line\n    console.error(\"Failed to load the locale\", locale);\n    locales = await loadLocales(\"en\");\n  }\n\n  document.getElementById(\"msg\").innerText = translate(\"webAuthnFallbackMsg\");\n  document.getElementById(\"remember-label\").innerText = translate(\"rememberMe\");\n\n  const button = document.getElementById(\"webauthn-button\");\n  button.innerText = translate(\"webAuthnAuthenticate\");\n  button.onclick = start;\n\n  document.getElementById(\"spinner\").classList.add(\"d-none\");\n  const content = document.getElementById(\"content\");\n  content.classList.add(\"d-block\");\n  content.classList.remove(\"d-none\");\n});\n\nasync function loadLocales(newLocale: string) {\n  const filePath = `locales/${newLocale}/messages.json?cache=${process.env.CACHE_TAG}`;\n  const localesResult = await fetch(filePath);\n  return await localesResult.json();\n}\n\nfunction translate(id: string) {\n  return locales[id]?.message || \"\";\n}\n\nfunction start() {\n  if (sentSuccess) {\n    return;\n  }\n\n  if (!(\"credentials\" in navigator)) {\n    error(translate(\"webAuthnNotSupported\"));\n    return;\n  }\n\n  parseParameters();\n  if (!webauthnJson) {\n    error(\"No data.\");\n    return;\n  }\n\n  let json: any;\n  try {\n    json = parseWebauthnJson(webauthnJson);\n  } catch (e) {\n    error(\"Cannot parse data.\");\n    return;\n  }\n\n  initWebAuthn(json);\n}\n\nasync function initWebAuthn(obj: any) {\n  try {\n    const assertedCredential = (await navigator.credentials.get({\n      publicKey: obj,\n    })) as PublicKeyCredential;\n\n    if (sentSuccess) {\n      return;\n    }\n\n    const dataString = buildDataString(assertedCredential);\n    const remember = (document.getElementById(\"remember\") as HTMLInputElement).checked;\n    window.postMessage({ command: \"webAuthnResult\", data: dataString, remember: remember }, \"*\");\n\n    sentSuccess = true;\n    success(translate(\"webAuthnSuccess\"));\n  } catch (err) {\n    error(err);\n  }\n}\n\nfunction error(message: string) {\n  const el = document.getElementById(\"msg\");\n  resetMsgBox(el);\n  el.textContent = message;\n  el.classList.add(\"alert\");\n  el.classList.add(\"alert-danger\");\n}\n\nfunction success(message: string) {\n  (document.getElementById(\"webauthn-button\") as HTMLButtonElement).disabled = true;\n\n  const el = document.getElementById(\"msg\");\n  resetMsgBox(el);\n  el.textContent = message;\n  el.classList.add(\"alert\");\n  el.classList.add(\"alert-success\");\n}\n\nfunction resetMsgBox(el: HTMLElement) {\n  el.classList.remove(\"alert\");\n  el.classList.remove(\"alert-danger\");\n  el.classList.remove(\"alert-success\");\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(48702);\n"],"names":["coerceToBase64Url","thing","Array","isArray","Uint8Array","from","ArrayBuffer","str","len","byteLength","i","String","fromCharCode","window","btoa","Error","replace","assertedCredential","response","authData","authenticatorData","clientDataJSON","rawId","sig","signature","data","id","type","extensions","getClientExtensionResults","clientDataJson","JSON","stringify","jsonString","json","parse","challenge","atob","c","charCodeAt","allowCredentials","forEach","listItem","fixedId","name","url","location","href","results","RegExp","exec","decodeURIComponent","spaceAsPlus","prototype","map","call","toString","slice","join","webauthnJson","parsed","parentUrl","sentSuccess","locale","locales","parseParameters","getQsParam","error","b64Decode","parseParametersV1","dataObj","e","parseParametersV2","loadLocales","newLocale","filePath","localesResult","fetch","translate","message","start","navigator","parseWebauthnJson","obj","credentials","get","publicKey","dataString","buildDataString","remember","document","getElementById","checked","postMessage","command","disabled","el","resetMsgBox","textContent","classList","add","success","err","initWebAuthn","remove","addEventListener","console","innerText","button","onclick","content","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","r","Symbol","toStringTag","Object","defineProperty","value"],"sourceRoot":""}