{"version":3,"file":"connectors/duo.a6f1c5c588d82573ece1.js","mappings":"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","sources":["webpack://@bitwarden/web-vault/./src/connectors/common.ts","webpack://@bitwarden/web-vault/./node_modules/duo_web_sdk/index.js","webpack://@bitwarden/web-vault/webpack/bootstrap","webpack://@bitwarden/web-vault/webpack/runtime/make namespace object","webpack://@bitwarden/web-vault/./src/connectors/duo.ts"],"sourcesContent":["export function getQsParam(name: string) {\n  const url = window.location.href;\n  // eslint-disable-next-line\n  name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n  const regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\");\n  const results = regex.exec(url);\n\n  if (!results) {\n    return null;\n  }\n  if (!results[2]) {\n    return \"\";\n  }\n\n  return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n}\n\nexport function b64Decode(str: string, spaceAsPlus = false) {\n  if (spaceAsPlus) {\n    str = str.replace(/ /g, \"+\");\n  }\n\n  return decodeURIComponent(\n    Array.prototype.map\n      .call(atob(str), (c: string) => {\n        return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\n      })\n      .join(\"\")\n  );\n}\n","/**\n * Duo Web SDK v2\n * Copyright 2021, Duo Security\n */\n\n(function (root, factory) {\n    /*eslint-disable */\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define([], factory);\n    /*eslint-enable */\n    } else if (typeof module === 'object' && module.exports) {\n        // Node. Does not work with strict CommonJS, but\n        // only CommonJS-like environments that support module.exports,\n        // like Node.\n        module.exports = factory();\n    } else {\n        // Browser globals (root is window)\n        var Duo = factory();\n        // If the Javascript was loaded via a script tag, attempt to autoload\n        // the frame.\n        Duo._onReady(Duo.init);\n\n        // Attach Duo to the `window` object\n        root.Duo = Duo;\n  }\n}(this, function() {\n    var DUO_MESSAGE_FORMAT = /^(?:AUTH|ENROLL)+\\|[A-Za-z0-9\\+\\/=]+\\|[A-Za-z0-9\\+\\/=]+$/;\n    var DUO_ERROR_FORMAT = /^ERR\\|[\\w\\s\\.\\(\\)]+$/;\n    var DUO_OPEN_WINDOW_FORMAT = /^DUO_OPEN_WINDOW\\|/;\n    var VALID_OPEN_WINDOW_DOMAINS = [\n        'duo.com',\n        'duosecurity.com',\n        'duomobile.s3-us-west-1.amazonaws.com'\n    ];\n\n    var postAction,\n        postArgument,\n        host,\n        sigRequest,\n        duoSig,\n        appSig,\n        iframe,\n        submitCallback;\n\n    // We use this function instead of setting initial values in the var\n    // declarations to make sure the initial values and subsequent\n    // re-initializations are always the same.\n    initializeStatefulVariables();\n\n    /**\n     * Set local variables to whatever they should be before you call init().\n     */\n    function initializeStatefulVariables() {\n        postAction = '';\n        postArgument = 'sig_response';\n        host = undefined;\n        sigRequest = undefined;\n        duoSig = undefined;\n        appSig = undefined;\n        iframe = undefined;\n        submitCallback = undefined;\n    }\n\n    function throwError(message, givenUrl) {\n        var url = (\n            givenUrl ||\n            'https://www.duosecurity.com/docs/duoweb#3.-show-the-iframe'\n        );\n        throw new Error(\n            'Duo Web SDK error: ' + message +\n            (url ? ('\\n' + 'See ' + url + ' for more information') : '')\n        );\n    }\n\n    function hyphenize(str) {\n        return str.replace(/([a-z])([A-Z])/, '$1-$2').toLowerCase();\n    }\n\n    // cross-browser data attributes\n    function getDataAttribute(element, name) {\n        if ('dataset' in element) {\n            return element.dataset[name];\n        } else {\n            return element.getAttribute('data-' + hyphenize(name));\n        }\n    }\n\n    // cross-browser event binding/unbinding\n    function on(context, event, fallbackEvent, callback) {\n        if ('addEventListener' in window) {\n            context.addEventListener(event, callback, false);\n        } else {\n            context.attachEvent(fallbackEvent, callback);\n        }\n    }\n\n    function off(context, event, fallbackEvent, callback) {\n        if ('removeEventListener' in window) {\n            context.removeEventListener(event, callback, false);\n        } else {\n            context.detachEvent(fallbackEvent, callback);\n        }\n    }\n\n    function onReady(callback) {\n        on(document, 'DOMContentLoaded', 'onreadystatechange', callback);\n    }\n\n    function offReady(callback) {\n        off(document, 'DOMContentLoaded', 'onreadystatechange', callback);\n    }\n\n    function onMessage(callback) {\n        on(window, 'message', 'onmessage', callback);\n    }\n\n    function offMessage(callback) {\n        off(window, 'message', 'onmessage', callback);\n    }\n\n    /**\n     * Parse the sig_request parameter, throwing errors if the token contains\n     * a server error or if the token is invalid.\n     *\n     * @param {String} sig Request token\n     */\n    function parseSigRequest(sig) {\n        if (!sig) {\n            // nothing to do\n            return;\n        }\n\n        // see if the token contains an error, throwing it if it does\n        if (sig.indexOf('ERR|') === 0) {\n            throwError(sig.split('|')[1]);\n        }\n\n        // validate the token\n        if (sig.indexOf(':') === -1 || sig.split(':').length !== 2) {\n            throwError(\n                'Duo was given a bad token.  This might indicate a configuration ' +\n                'problem with one of Duo\\'s client libraries.'\n            );\n        }\n\n        var sigParts = sig.split(':');\n\n        // hang on to the token, and the parsed duo and app sigs\n        sigRequest = sig;\n        duoSig = sigParts[0];\n        appSig = sigParts[1];\n\n        return {\n            sigRequest: sig,\n            duoSig: sigParts[0],\n            appSig: sigParts[1]\n        };\n    }\n\n    /**\n     * Validate that a MessageEvent came from the Duo service, and that it\n     * is a properly formatted payload.\n     *\n     * The Google Chrome sign-in page injects some JS into pages that also\n     * make use of postMessage, so we need to do additional validation above\n     * and beyond the origin.\n     *\n     * @param {MessageEvent} event Message received via postMessage\n     */\n    function isDuoMessage(event) {\n        return Boolean(\n            event.origin === ('https://' + host) &&\n            typeof event.data === 'string' &&\n            (\n                event.data.match(DUO_MESSAGE_FORMAT) ||\n                event.data.match(DUO_ERROR_FORMAT) ||\n                event.data.match(DUO_OPEN_WINDOW_FORMAT)\n            )\n        );\n    }\n\n    /**\n     * Validate the request token and prepare for the iframe to become ready.\n     *\n     * All options below can be passed into an options hash to `Duo.init`, or\n     * specified on the iframe using `data-` attributes.\n     *\n     * Options specified using the options hash will take precedence over\n     * `data-` attributes.\n     *\n     * Example using options hash:\n     * ```javascript\n     * Duo.init({\n     *     iframe: \"some_other_id\",\n     *     host: \"api-main.duo.test\",\n     *     sig_request: \"...\",\n     *     post_action: \"/auth\",\n     *     post_argument: \"resp\"\n     * });\n     * ```\n     *\n     * Example using `data-` attributes:\n     * ```html\n     * <iframe id=\"duo_iframe\"\n     *         data-host=\"api-main.duo.test\"\n     *         data-sig-request=\"...\"\n     *         data-post-action=\"/auth\"\n     *         data-post-argument=\"resp\"\n     *         >\n     * </iframe>\n     * ```\n     *\n     * Some browsers (especially embedded browsers) don't like it when the Duo\n     * Web SDK changes the `src` attribute on the iframe. To prevent this, there\n     * is an alternative way to use the Duo Web SDK:\n     *\n     * Add a div (or any other container element) instead of an iframe to the\n     * DOM with an id of \"duo_iframe\", or pass that element to the\n     * `iframeContainer` parameter of `Duo.init`. An iframe will be created and\n     * inserted into that container element, preventing `src` change related\n     * bugs. WARNING: All other elements in the container will be deleted.\n     *\n     * The `iframeAttributes` parameter of `Duo.init` is available to set any\n     * attributes on the inserted iframe if the Duo Web SDK is inserting the\n     * iframe. For details, see the parameter documentation below.\n     *\n     * @param {Object} options\n     * @param {String} options.host - Hostname for the Duo Prompt.\n     * @param {String} options.sig_request - Request token.\n     * @param {String|HTMLElement} [options.iframe] - The iframe, or id of an\n     *     iframe that will be used for the Duo Prompt. If you don't provide\n     *     this or the `iframeContainer` parameter the Duo Web SDK will default\n     *     to using whatever element has an id of \"duo_iframe\".\n     * @param {String|HTMLElement} [options.iframeContainer] - The element you\n     *     want the Duo Prompt inserted into, or the id of that element.\n     *     Anything inside this element will be deleted and replaced with an\n     *     iframe hosting the Duo prompt. If you don't provide this or the\n     *     `iframe` parameter the Duo Web SDK will default to using whatever\n     *     element has an id of \"duo_iframe\".\n     * @param {Object} [options.iframeAttributes] - Object with  names and\n     *     values coresponding to attributes you want added to the  Duo Prompt\n     *     iframe, like `title`, `width` and `allow`. WARNING: this parameter\n     *     only works if you use the `iframeContainer` parameter or add an id\n     *     of \"duo_iframe\" to an element that isn't an iframe. If you have\n     *     added an iframe to the DOM yourself, you should set those attributes\n     *     directly on the iframe.\n     * @param {String} [options.post_action=''] - URL to POST back to after a\n     *     successful auth.\n     * @param {String} [options.post_argument='sig_response'] - Parameter name\n     *     to use for response token.\n     * @param {Function} [options.submit_callback] - If provided, the Duo Web\n     *     SDK will not submit the form. Instead it will execute this callback\n     *     function passing in a reference to the \"duo_form\" form object.\n     *     `submit_callback`` can be used to prevent the webpage from reloading.\n     */\n    function init(options) {\n        // If init() is called more than once we have to reset all the local\n        // variables to ensure init() will work the same way every time. This\n        // helps people making single page applications. SPAs may periodically\n        // remove the iframe and add a new one that has to be initialized.\n        initializeStatefulVariables();\n\n        if (options) {\n            if (options.host) {\n                host = options.host;\n            }\n\n            if (options.sig_request) {\n                parseSigRequest(options.sig_request);\n            }\n\n            if (options.post_action) {\n                postAction = options.post_action;\n            }\n\n            if (options.post_argument) {\n                postArgument = options.post_argument;\n            }\n\n            if (typeof options.submit_callback === 'function') {\n                submitCallback = options.submit_callback;\n            }\n        }\n\n        var promptElement = getPromptElement(options);\n        if (promptElement) {\n            // If we can get the element that will host the prompt, set it.\n            ready(promptElement, options.iframeAttributes || {});\n        } else {\n            // If the element that will host the prompt isn't available yet, set\n            // it up after the DOM finishes loading.\n            asyncReady(options);\n        }\n\n        // always clean up after yourself!\n        offReady(init);\n    }\n\n    /**\n     * Given the options from init(), get the iframe or iframe container that\n     * should be used for the Duo Prompt. Returns `null` if nothing was found.\n     */\n    function getPromptElement(options) {\n        var result;\n\n        if (options.iframe && options.iframeContainer) {\n            throwError(\n                'Passing both `iframe` and `iframeContainer` arguments at the' +\n                ' same time is not allowed.'\n            );\n        } else if (options.iframe) {\n            // If we are getting an iframe, try to get it and raise if the\n            // element we find is NOT an iframe.\n            result = getUserDefinedElement(options.iframe);\n            validateIframe(result);\n        } else if (options.iframeContainer) {\n            result = getUserDefinedElement(options.iframeContainer);\n            validateIframeContainer(result);\n        } else {\n            result = document.getElementById('duo_iframe');\n        }\n\n        return result;\n    }\n\n    /**\n     * When given an HTMLElement, return it. When given a string, get an element\n     * with that id, else return null.\n     */\n    function getUserDefinedElement(object) {\n        if (object.tagName) {\n            return object;\n        } else if (typeof object == 'string') {\n            return document.getElementById(object);\n        }\n        return null;\n    }\n\n    /**\n     * Check if the given thing is an iframe.\n     */\n    function isIframe(element) {\n        return (\n            element &&\n            element.tagName &&\n            element.tagName.toLowerCase() === 'iframe'\n        );\n    }\n\n    /**\n     * Throw an error if we are given an element that is NOT an iframe.\n     */\n    function validateIframe(element) {\n        if (element && !isIframe(element)) {\n            throwError(\n                '`iframe` only accepts an iframe element or the id of an' +\n                ' iframe. To use a non-iframe element, use the' +\n                ' `iframeContainer` argument.'\n            );\n        }\n    }\n\n    /**\n     * Throw an error if we are given an element that IS an iframe instead of an\n     * element that we can insert an iframe into.\n     */\n    function validateIframeContainer(element) {\n        if (element && isIframe(element)) {\n            throwError(\n                '`iframeContainer` only accepts a non-iframe element or the' +\n                ' id of a non-iframe. To use a non-iframe element, use the' +\n                ' `iframeContainer` argument on Duo.init().'\n            );\n        }\n    }\n\n    /**\n     * Generate the URL that goes to the Duo Prompt.\n     */\n    function generateIframeSrc() {\n        return [\n            'https://', host, '/frame/web/v1/auth?tx=', encodeURIComponent(duoSig),\n            '&parent=', encodeURIComponent(document.location.href),\n            '&v=2.9'\n        ].join('');\n    }\n\n    /**\n     * This function is called when a message was received from another domain\n     * using the `postMessage` API.  Check that the event came from the Duo\n     * service domain, and that the message is a properly formatted payload,\n     * then perform the post back to the primary service.\n     *\n     * @param event Event object (contains origin and data)\n     */\n    function onReceivedMessage(event) {\n        if (isDuoMessage(event)) {\n            if (event.data.match(DUO_OPEN_WINDOW_FORMAT)) {\n                var url = event.data.substring(\"DUO_OPEN_WINDOW|\".length);\n                if (isValidUrlToOpen(url)) {\n                    // Open the URL that comes after the DUO_WINDOW_OPEN token.\n                    window.open(url, \"_self\");\n                }\n            }\n            else {\n                // the event came from duo, do the post back\n                doPostBack(event.data);\n\n                // always clean up after yourself!\n                offMessage(onReceivedMessage);\n            }\n        }\n    }\n\n    /**\n     * Validate that this passed in URL is one that we will actually allow to\n     * be opened.\n     * @param url String URL that the message poster wants to open\n     * @returns {boolean} true if we allow this url to be opened in the window\n     */\n    function isValidUrlToOpen(url) {\n        if (!url) {\n            return false;\n        }\n\n        var parser = document.createElement('a');\n        parser.href = url;\n\n        if (parser.protocol === \"duotrustedendpoints:\") {\n            return true;\n        } else if (parser.protocol !== \"https:\") {\n            return false;\n        }\n\n        for (var i = 0; i < VALID_OPEN_WINDOW_DOMAINS.length; i++) {\n           if (parser.hostname.endsWith(\".\" + VALID_OPEN_WINDOW_DOMAINS[i]) ||\n                   parser.hostname === VALID_OPEN_WINDOW_DOMAINS[i]) {\n               return true;\n           }\n        }\n        return false;\n    }\n\n    /**\n     * Register a callback to call ready() after the DOM has loaded.\n     */\n    function asyncReady(options) {\n        var callback = function() {\n            var promptElement = getPromptElement(options);\n            if (!promptElement) {\n                throwError(\n                    'This page does not contain an iframe for Duo to use.' +\n                    ' Add an element like' +\n                    ' <iframe id=\"duo_iframe\"></iframe> to this page.'\n                );\n            }\n\n            ready(promptElement, options.iframeAttributes || {});\n\n            // Always clean up after yourself.\n            offReady(callback)\n        };\n\n        onReady(callback);\n    }\n\n    /**\n     * Point the iframe at Duo, then wait for it to postMessage back to us.\n     */\n    function ready(promptElement, iframeAttributes) {\n        if (!host) {\n            host = getDataAttribute(promptElement, 'host');\n\n            if (!host) {\n                throwError(\n                    'No API hostname is given for Duo to use.  Be sure to pass ' +\n                    'a `host` parameter to Duo.init, or through the `data-host` ' +\n                    'attribute on the iframe element.'\n                );\n            }\n        }\n\n        if (!duoSig || !appSig) {\n            parseSigRequest(getDataAttribute(promptElement, 'sigRequest'));\n\n            if (!duoSig || !appSig) {\n                throwError(\n                    'No valid signed request is given.  Be sure to give the ' +\n                    '`sig_request` parameter to Duo.init, or use the ' +\n                    '`data-sig-request` attribute on the iframe element.'\n                );\n            }\n        }\n\n        // if postAction/Argument are defaults, see if they are specified\n        // as data attributes on the iframe\n        if (postAction === '') {\n            postAction = getDataAttribute(promptElement, 'postAction') || postAction;\n        }\n\n        if (postArgument === 'sig_response') {\n            postArgument = getDataAttribute(promptElement, 'postArgument') || postArgument;\n        }\n\n        if (isIframe(promptElement)) {\n            iframe = promptElement;\n            iframe.src = generateIframeSrc();\n        } else {\n            // If given a container to put an iframe in, clean out any children\n            // child elements in case `init()` was called more than once.\n            while (promptElement.firstChild) {\n                // We call `removeChild()` instead of doing `innerHTML = \"\"`\n                // to make sure we unbind any events.\n                promptElement.removeChild(promptElement.firstChild);\n            }\n\n            iframe = document.createElement('iframe');\n\n            // Set the src and all other attributes on the new iframe.\n            iframeAttributes['src'] = generateIframeSrc();\n            for (var name in iframeAttributes) {\n                iframe.setAttribute(name, iframeAttributes[name]);\n            }\n\n            promptElement.appendChild(iframe);\n        }\n\n        // listen for the 'message' event\n        onMessage(onReceivedMessage);\n    }\n\n    /**\n     * We received a postMessage from Duo.  POST back to the primary service\n     * with the response token, and any additional user-supplied parameters\n     * given in form#duo_form.\n     */\n    function doPostBack(response) {\n        // create a hidden input to contain the response token\n        var input = document.createElement('input');\n        input.type = 'hidden';\n        input.name = postArgument;\n        input.value = response + ':' + appSig;\n\n        // user may supply their own form with additional inputs\n        var form = document.getElementById('duo_form');\n\n        // if the form doesn't exist, create one\n        if (!form) {\n            form = document.createElement('form');\n\n            // insert the new form after the iframe\n            iframe.parentElement.insertBefore(form, iframe.nextSibling);\n        }\n\n        // make sure we are actually posting to the right place\n        form.method = 'POST';\n        form.action = postAction;\n\n        // add the response token input to the form\n        form.appendChild(input);\n\n        // away we go!\n        if (typeof submitCallback === \"function\") {\n            submitCallback.call(null, form);\n        } else {\n            form.submit();\n        }\n    }\n\n    return {\n        init: init,\n        _onReady: onReady,\n        _parseSigRequest: parseSigRequest,\n        _isDuoMessage: isDuoMessage,\n        _doPostBack: doPostBack\n    };\n}));\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import * as DuoWebSDK from \"duo_web_sdk\";\n\nimport { getQsParam } from \"./common\";\n\nrequire(\"./duo.scss\");\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  const frameElement = document.createElement(\"iframe\");\n  frameElement.setAttribute(\"id\", \"duo_iframe\");\n  setFrameHeight();\n  document.body.appendChild(frameElement);\n\n  const hostParam = getQsParam(\"host\");\n  const requestParam = getQsParam(\"request\");\n\n  const hostUrl = new URL(\"https://\" + hostParam);\n  if (\n    !hostUrl.hostname.endsWith(\".duosecurity.com\") &&\n    !hostUrl.hostname.endsWith(\".duofederal.com\")\n  ) {\n    return;\n  }\n\n  DuoWebSDK.init({\n    iframe: \"duo_iframe\",\n    host: hostParam,\n    sig_request: requestParam,\n    submit_callback: (form: any) => {\n      invokeCSCode(form.elements.sig_response.value);\n    },\n  });\n\n  window.onresize = setFrameHeight;\n\n  function setFrameHeight() {\n    frameElement.style.height = window.innerHeight + \"px\";\n  }\n});\n\nfunction invokeCSCode(data: string) {\n  try {\n    (window as any).invokeCSharpAction(data);\n  } catch (err) {\n    // eslint-disable-next-line\n    console.log(err);\n  }\n}\n"],"names":["name","url","window","location","href","replace","results","RegExp","exec","decodeURIComponent","str","spaceAsPlus","Array","prototype","map","call","atob","c","charCodeAt","toString","slice","join","postAction","postArgument","host","duoSig","appSig","iframe","submitCallback","DUO_MESSAGE_FORMAT","DUO_ERROR_FORMAT","DUO_OPEN_WINDOW_FORMAT","VALID_OPEN_WINDOW_DOMAINS","initializeStatefulVariables","undefined","throwError","message","givenUrl","Error","hyphenize","toLowerCase","getDataAttribute","element","dataset","getAttribute","on","context","event","fallbackEvent","callback","addEventListener","attachEvent","off","removeEventListener","detachEvent","onReady","document","offReady","onMessage","offMessage","parseSigRequest","sig","indexOf","split","length","sigParts","sigRequest","isDuoMessage","Boolean","origin","data","match","init","options","sig_request","post_action","post_argument","submit_callback","promptElement","getPromptElement","ready","iframeAttributes","asyncReady","result","iframeContainer","validateIframe","getUserDefinedElement","validateIframeContainer","getElementById","object","tagName","isIframe","generateIframeSrc","encodeURIComponent","onReceivedMessage","substring","isValidUrlToOpen","open","doPostBack","parser","createElement","protocol","i","hostname","endsWith","src","firstChild","removeChild","setAttribute","appendChild","response","input","type","value","form","parentElement","insertBefore","nextSibling","method","action","submit","_onReady","_parseSigRequest","_isDuoMessage","_doPostBack","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","r","Symbol","toStringTag","Object","defineProperty","frameElement","setFrameHeight","body","hostParam","getQsParam","requestParam","hostUrl","URL","style","height","innerHeight","DuoWebSDK","invokeCSharpAction","err","console","log","invokeCSCode","elements","sig_response","onresize"],"sourceRoot":""}